<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>How to use SpatialSablefishAssessment in a MSE | SpatialSablefishAssessment</title>
  <meta name="description" content="This Gitbook describes the spatial sablefish stock assessment R package and how to use it" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="How to use SpatialSablefishAssessment in a MSE | SpatialSablefishAssessment" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This Gitbook describes the spatial sablefish stock assessment R package and how to use it" />
  <meta name="github-repo" content="https://github.com/Craig44/SpatialSablefishAssessment" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="How to use SpatialSablefishAssessment in a MSE | SpatialSablefishAssessment" />
  
  <meta name="twitter:description" content="This Gitbook describes the spatial sablefish stock assessment R package and how to use it" />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2023-12-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="assessment-data-and-parameter-descriptions.html"/>
<link rel="next" href="adding-unit-tests.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SpatialSablefishAssessment</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><i class="fa fa-check"></i>A list of functions available in the <code>SpatialSablefishAssessment</code> package</a>
<ul>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#validate-functions"><i class="fa fa-check"></i>Validate functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#accessor-functions"><i class="fa fa-check"></i>Accessor functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#plotting-functions"><i class="fa fa-check"></i>Plotting functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#estimation-functions"><i class="fa fa-check"></i>Estimation functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#projectionreference-point-functions"><i class="fa fa-check"></i>Projection/Reference point functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#model-comparison-functions"><i class="fa fa-check"></i>Model comparison functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#distribution-functions"><i class="fa fa-check"></i>Distribution functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#parameter-transformation-functions"><i class="fa fa-check"></i>Parameter transformation functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#data-grooming-functions"><i class="fa fa-check"></i>Data grooming functions</a></li>
<li class="chapter" data-level="" data-path="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html"><a href="a-list-of-functions-available-in-the-spatialsablefishassessment-package.html#auxillary-functions"><i class="fa fa-check"></i>Auxillary functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html"><i class="fa fa-check"></i>How to use <code>SpatialSablefishAssessment</code></a>
<ul>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#configuring-and-checking-model-inputs-data-and-parameters"><i class="fa fa-check"></i>Configuring and checking model inputs (data and parameters)</a>
<ul>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#simple-sanity-checks"><i class="fa fa-check"></i>Simple sanity checks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#optimisation"><i class="fa fa-check"></i>Optimisation</a>
<ul>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#check-convergence"><i class="fa fa-check"></i>Check convergence</a></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#fixing-estimable-parameters-at-input-values"><i class="fa fa-check"></i>Fixing estimable parameters at input values</a></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#sharing-parameter-estimates-among-estimable-variables-i.e.-male-and-female-having-a-common-selectivity"><i class="fa fa-check"></i>Sharing parameter estimates among estimable variables i.e., male and female having a common selectivity</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#model-summary"><i class="fa fa-check"></i>Model Summary</a></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment.html"><a href="how-to-use-spatialsablefishassessment.html#mcmc-inference"><i class="fa fa-check"></i>MCMC inference</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html"><i class="fa fa-check"></i><code>TagIntegrated</code> model equations</a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#process-equations"><i class="fa fa-check"></i>Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#population-dynamics"><i class="fa fa-check"></i>Population dynamics</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#initialisation"><i class="fa fa-check"></i>Initialisation</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#growth"><i class="fa fa-check"></i>Growth</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#recruitment"><i class="fa fa-check"></i>Recruitment</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#spawning-biomass"><i class="fa fa-check"></i>Spawning biomass</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#fishing-mortality"><i class="fa fa-check"></i>Fishing mortality</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#tag-release-events"><i class="fa fa-check"></i>Tag release events</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#selectivities"><i class="fa fa-check"></i>Selectivities</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#observation-equations"><i class="fa fa-check"></i>Observation equations</a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#catch-at-age"><i class="fa fa-check"></i>Catch at age</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#catch-at-length"><i class="fa fa-check"></i>Catch at length</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#proportions-at-age"><i class="fa fa-check"></i>Proportions at age</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#relative-abundance-indices"><i class="fa fa-check"></i>Relative abundance indices</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#tag-recovery-observations"><i class="fa fa-check"></i>Tag recovery observations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#likelihood-formulations"><i class="fa fa-check"></i>Likelihood formulations</a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#multinomial"><i class="fa fa-check"></i>Multinomial</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#dirichlet-multinomial"><i class="fa fa-check"></i>Dirichlet-Multinomial</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#lognormal"><i class="fa fa-check"></i>Lognormal</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#projecting"><i class="fa fa-check"></i>Projecting</a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#recruitment-1"><i class="fa fa-check"></i>Recruitment</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#fishing"><i class="fa fa-check"></i>Fishing</a></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#example-code-snippets"><i class="fa fa-check"></i>Example code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-model-equations.html"><a href="tagintegrated-model-equations.html#symbol-notation"><i class="fa fa-check"></i>Symbol Notation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-data-and-parameter-descriptions.html"><a href="tagintegrated-data-and-parameter-descriptions.html"><i class="fa fa-check"></i><code>TagIntegrated</code> <code>data</code> and <code>parameter</code> descriptions</a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-data-and-parameter-descriptions.html"><a href="tagintegrated-data-and-parameter-descriptions.html#data"><i class="fa fa-check"></i><code>data</code></a>
<ul>
<li class="chapter" data-level="" data-path="tagintegrated-data-and-parameter-descriptions.html"><a href="tagintegrated-data-and-parameter-descriptions.html#additional-data-inputs-for-tagintegratedvalidate"><i class="fa fa-check"></i>Additional data inputs for <code>TagIntegratedValidate</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagintegrated-data-and-parameter-descriptions.html"><a href="tagintegrated-data-and-parameter-descriptions.html#parameters"><i class="fa fa-check"></i><code>parameters</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assessment-data-and-parameter-descriptions.html"><a href="assessment-data-and-parameter-descriptions.html"><i class="fa fa-check"></i><code>Assessment</code> <code>data</code> and <code>parameter</code> descriptions</a>
<ul>
<li class="chapter" data-level="" data-path="assessment-data-and-parameter-descriptions.html"><a href="assessment-data-and-parameter-descriptions.html#data-1"><i class="fa fa-check"></i><code>data</code></a></li>
<li class="chapter" data-level="" data-path="assessment-data-and-parameter-descriptions.html"><a href="assessment-data-and-parameter-descriptions.html#parameters-1"><i class="fa fa-check"></i><code>parameters</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="how-to-use-spatialsablefishassessment-in-a-mse.html"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html"><i class="fa fa-check"></i>How to use <code>SpatialSablefishAssessment</code> in a MSE</a></li>
<li class="chapter" data-level="" data-path="adding-unit-tests.html"><a href="adding-unit-tests.html"><i class="fa fa-check"></i>Adding Unit Tests</a></li>
<li class="chapter" data-level="" data-path="contributing-to-spatialsablefishassessment.html"><a href="contributing-to-spatialsablefishassessment.html"><i class="fa fa-check"></i>Contributing to <code>SpatialSablefishAssessment</code></a>
<ul>
<li class="chapter" data-level="" data-path="contributing-to-spatialsablefishassessment.html"><a href="contributing-to-spatialsablefishassessment.html#adding-a-new-r-dependency"><i class="fa fa-check"></i>Adding a new R dependency</a></li>
<li class="chapter" data-level="" data-path="contributing-to-spatialsablefishassessment.html"><a href="contributing-to-spatialsablefishassessment.html#tips"><i class="fa fa-check"></i>Tips</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/Craig44/SpatialSablefishAssessment" target="blank">Github Repo here</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SpatialSablefishAssessment</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="how-to-use-spatialsablefishassessment-in-a-mse" class="section level1 unnumbered hasAnchor">
<h1>How to use <code>SpatialSablefishAssessment</code> in a MSE<a href="how-to-use-spatialsablefishassessment-in-a-mse.html#how-to-use-spatialsablefishassessment-in-a-mse" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Using the current Sablefish assessment model, but with simplified observations, we demonstrate some R code that can be used to run an MSE. The following R-code manually steps through a few assessment cycles which could be wrapped in a loop.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb21-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Demonstrate MSE functionality</span></span>
<span id="cb21-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb21-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpatialSablefishAssessment)</span>
<span id="cb21-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb21-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="do">## The code line below will import three objects</span></span>
<span id="cb21-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="do">## &#39;data&#39;, &#39;parameters&#39; and &#39;region_key&#39; These are</span></span>
<span id="cb21-10"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="do">## objects that were based on the Sablefish 2021 assessment</span></span>
<span id="cb21-11"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">system.file</span>(<span class="st">&quot;testdata&quot;</span>, <span class="st">&quot;MockAssessmentModel.RData&quot;</span>,<span class="at">package=</span><span class="st">&quot;SpatialSablefishAssessment&quot;</span>))</span>
<span id="cb21-12"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(data))</span></code></pre></div>
<pre><code>## [1] &quot;ages&quot;                &quot;years&quot;               &quot;length_bins&quot;        
## [4] &quot;n_regions&quot;           &quot;n_projections_years&quot; &quot;do_projection&quot;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(parameters))</span></code></pre></div>
<pre><code>## [1] &quot;ln_mean_rec&quot;     &quot;ln_rec_dev&quot;      &quot;ln_init_rec_dev&quot; &quot;ln_ll_F_avg&quot;    
## [5] &quot;ln_ll_F_devs&quot;    &quot;ln_trwl_F_avg&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simplify inputs from the Sablefish assessment for demonstration purposes</span></span>
<span id="cb25-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Only one LL survey</span></span>
<span id="cb25-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## with constant selectivity and Q</span></span>
<span id="cb25-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-4" aria-hidden="true" tabindex="-1"></a>fishery_obs_years <span class="ot">=</span> <span class="dv">1990</span><span class="sc">:</span><span class="dv">2022</span></span>
<span id="cb25-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-5" aria-hidden="true" tabindex="-1"></a>survey_years <span class="ot">=</span> <span class="dv">1978</span><span class="sc">:</span><span class="dv">2022</span></span>
<span id="cb25-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-6" aria-hidden="true" tabindex="-1"></a>n_projyears <span class="ot">=</span> <span class="fu">length</span>(data<span class="sc">$</span>years) <span class="sc">+</span> data<span class="sc">$</span>n_projections_years</span>
<span id="cb25-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-7" aria-hidden="true" tabindex="-1"></a>n_ages <span class="ot">=</span> <span class="fu">length</span>(data<span class="sc">$</span>ages)</span>
<span id="cb25-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-8" aria-hidden="true" tabindex="-1"></a>n_lgths <span class="ot">=</span> <span class="fu">length</span>(data<span class="sc">$</span>length_bins)</span>
<span id="cb25-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="do">## specify single q and single logistic selectivity for</span></span>
<span id="cb25-10"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="do">## survey, LL fishery and Trawl fishery</span></span>
<span id="cb25-11"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_q_by_year_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-12"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_sel_by_year_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-13"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_sel_type <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>)</span>
<span id="cb25-14"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ll_sel_by_year_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-15"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ll_cpue_q_by_year_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-16"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-16" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ll_sel_type <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>)</span>
<span id="cb25-17"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-17" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>trwl_sel_by_year_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-18"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>trwl_sel_type <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>)</span>
<span id="cb25-19"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="do">## specify survey observation containers</span></span>
<span id="cb25-20"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_bio_indicator <span class="ot">=</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>years <span class="sc">%in%</span> survey_years)</span>
<span id="cb25-21"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-21" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_lgth_indicator <span class="ot">=</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>years <span class="sc">%in%</span> survey_years)</span>
<span id="cb25-22"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-22" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_age_indicator <span class="ot">=</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>years <span class="sc">%in%</span> survey_years)</span>
<span id="cb25-23"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-23" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_dom_ll_bio_likelihood <span class="ot">=</span> <span class="dv">1</span> <span class="co"># this changes the intepretation of input Standard errors</span></span>
<span id="cb25-24"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-24" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>obs_dom_ll_bio <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">sum</span>(data<span class="sc">$</span>srv_dom_ll_bio_indicator))</span>
<span id="cb25-25"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-25" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>se_dom_ll_bio <span class="ot">=</span> <span class="fu">rep</span>(<span class="fl">0.07</span>, <span class="fu">sum</span>(data<span class="sc">$</span>srv_dom_ll_bio_indicator))</span>
<span id="cb25-26"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-26" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>obs_srv_dom_ll_lgth_m <span class="ot">=</span> data<span class="sc">$</span>obs_srv_dom_ll_lgth_f <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">5</span>, <span class="at">nrow =</span> n_lgths, <span class="at">ncol =</span> <span class="fu">sum</span>(data<span class="sc">$</span>srv_dom_ll_lgth_indicator))</span>
<span id="cb25-27"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-27" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>obs_srv_dom_ll_age <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">5</span>, <span class="at">nrow =</span> n_ages, <span class="at">ncol =</span> <span class="fu">sum</span>(data<span class="sc">$</span>srv_dom_ll_age_indicator))</span>
<span id="cb25-28"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># sample size for comp is 5 * n_ages = 150</span></span>
<span id="cb25-29"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="do">## specify LL fishery observatiosn</span></span>
<span id="cb25-30"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-30" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ll_cpue_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-31"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-31" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ll_catchatage_indicator <span class="ot">=</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>years <span class="sc">%in%</span> fishery_obs_years)</span>
<span id="cb25-32"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-32" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ll_catchatlgth_indicator <span class="ot">=</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>years <span class="sc">%in%</span> fishery_obs_years)</span>
<span id="cb25-33"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-33" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>obs_ll_catchatlgth_f <span class="ot">=</span> data<span class="sc">$</span>obs_ll_catchatlgth_m <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">5</span>, <span class="at">nrow =</span> n_lgths, <span class="at">ncol =</span> <span class="fu">sum</span>(data<span class="sc">$</span>ll_catchatlgth_indicator))</span>
<span id="cb25-34"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-34" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>obs_ll_catchatage <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">5</span>, <span class="at">nrow =</span> n_ages, <span class="at">ncol =</span> <span class="fu">sum</span>(data<span class="sc">$</span>ll_catchatage_indicator))</span>
<span id="cb25-35"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="do">## specify Trawl fishery observatiosn</span></span>
<span id="cb25-36"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-36" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>trwl_catchatlgth_indicator <span class="ot">=</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>years <span class="sc">%in%</span> fishery_obs_years)</span>
<span id="cb25-37"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-37" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>obs_trwl_catchatlgth_m <span class="ot">=</span> data<span class="sc">$</span>obs_trwl_catchatlgth_f <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">5</span>, <span class="at">nrow =</span> n_lgths, <span class="at">ncol =</span> <span class="fu">sum</span>(data<span class="sc">$</span>trwl_catchatlgth_indicator))</span>
<span id="cb25-38"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="do">## turn off all other observations and don&#39;t estimate their selectivities</span></span>
<span id="cb25-40"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-40" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_jap_ll_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-41"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-41" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_nmfs_trwl_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-42"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-42" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_jap_fishery_ll_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-43"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-43" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_jap_ll_age_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-44"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-44" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_jap_ll_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-45"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-45" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_jap_fishery_ll_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-46"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-46" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_nmfs_trwl_age_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-47"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-47" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>srv_nmfs_trwl_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_projyears)</span>
<span id="cb25-48"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-48" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_ll_catch <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb25-49"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-49" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_trwl_catch <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb25-50"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-50" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_ll_catchatage <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-51"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-51" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_ll_catchatlgth_f <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-52"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-52" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_ll_catchatlgth_m <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-53"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-53" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_srv_dom_ll_age <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-54"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-54" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_srv_dom_ll_lgth_m <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-55"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-55" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_srv_dom_ll_lgth_f <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-56"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-56" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_trwl_catchatlgth_f <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-57"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-57" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loglik_wgt_trwl_catchatlgth_m <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-58"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="do">## re set the parameters and turn some of them off</span></span>
<span id="cb25-59"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-59" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_trwl_sel_pars <span class="ot">=</span> <span class="fu">array</span>(parameters<span class="sc">$</span>ln_ll_sel_pars[<span class="dv">2</span>,,], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb25-60"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-60" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_trwl_sel_pars[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">3</span>)<span class="co"># male a50</span></span>
<span id="cb25-61"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-61" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_trwl_sel_pars[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">1.57</span>)<span class="co"># male delta</span></span>
<span id="cb25-62"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-62" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_trwl_sel_pars[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">3.7</span>)<span class="co"># female a50</span></span>
<span id="cb25-63"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-63" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_trwl_sel_pars[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">1.87</span>)<span class="co"># female delta</span></span>
<span id="cb25-64"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-65"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-65" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_ll_sel_pars <span class="ot">=</span> <span class="fu">array</span>(parameters<span class="sc">$</span>ln_ll_sel_pars[<span class="dv">1</span>,,], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb25-66"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-66" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_ll_sel_pars[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">4</span>)<span class="co"># male a50</span></span>
<span id="cb25-67"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-67" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_ll_sel_pars[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">1.77</span>)<span class="co"># male delta</span></span>
<span id="cb25-68"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-68" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_ll_sel_pars[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">5.3</span>)<span class="co"># female a50</span></span>
<span id="cb25-69"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-69" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_ll_sel_pars[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">1.27</span>)<span class="co"># female delta</span></span>
<span id="cb25-70"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-70" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_srv_dom_ll_sel_pars <span class="ot">=</span> <span class="fu">array</span>(parameters<span class="sc">$</span>ln_srv_dom_ll_sel_pars[<span class="dv">1</span>,,], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb25-71"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-71" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_srv_dom_ll_sel_pars[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">4</span>)<span class="co"># male a50</span></span>
<span id="cb25-72"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-72" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_srv_dom_ll_sel_pars[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">1.77</span>)<span class="co"># male delta</span></span>
<span id="cb25-73"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-73" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_srv_dom_ll_sel_pars[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">5.3</span>)<span class="co"># female a50</span></span>
<span id="cb25-74"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-74" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_srv_dom_ll_sel_pars[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(<span class="fl">1.27</span>)<span class="co"># female delta</span></span>
<span id="cb25-75"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-75" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_srv_dom_ll_q <span class="ot">=</span> parameters<span class="sc">$</span>ln_srv_dom_ll_q[<span class="dv">1</span>]</span>
<span id="cb25-76"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-76" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_ll_cpue_q <span class="ot">=</span> parameters<span class="sc">$</span>ln_ll_cpue_q[<span class="dv">1</span>]</span>
<span id="cb25-77"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="do">## set init-devs to equilibrium i.e., age-structure at year 1 is assumed to be unfished</span></span>
<span id="cb25-78"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-78" aria-hidden="true" tabindex="-1"></a>parameters<span class="sc">$</span>ln_init_rec_dev <span class="ot">=</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>data<span class="sc">$</span>sigma_R<span class="sc">^</span><span class="dv">2</span>, data<span class="sc">$</span>n_init_rec_devs)</span>
<span id="cb25-79"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-80"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-80" aria-hidden="true" tabindex="-1"></a><span class="do">## Only estimate some of the models parameters</span></span>
<span id="cb25-81"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-81" aria-hidden="true" tabindex="-1"></a>estimated_pars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;ln_mean_rec&quot;</span>,<span class="st">&quot;ln_rec_dev&quot;</span>,<span class="st">&quot;ln_ll_F_avg&quot;</span>, <span class="st">&quot;ln_ll_F_devs&quot;</span>,<span class="st">&quot;ln_trwl_F_avg&quot;</span>,<span class="st">&quot;ln_trwl_F_devs&quot;</span>,</span>
<span id="cb25-82"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-82" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;ln_ll_sel_pars&quot;</span>,<span class="st">&quot;ln_trwl_sel_pars&quot;</span>,<span class="st">&quot;ln_srv_dom_ll_sel_pars&quot;</span>, <span class="st">&quot;ln_srv_dom_ll_q&quot;</span>)</span>
<span id="cb25-83"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-84"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-84" aria-hidden="true" tabindex="-1"></a>na_map <span class="ot">=</span> <span class="fu">fix_pars</span>(<span class="at">par_list =</span> parameters, <span class="at">pars_to_exclude =</span> <span class="fu">unique</span>(<span class="fu">names</span>(parameters))[<span class="sc">!</span><span class="fu">unique</span>(<span class="fu">names</span>(parameters)) <span class="sc">%in%</span> estimated_pars])</span>
<span id="cb25-85"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-85" aria-hidden="true" tabindex="-1"></a><span class="do">## Don&#39;t worry that the below code fails.</span></span>
<span id="cb25-86"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-86" aria-hidden="true" tabindex="-1"></a><span class="do">## Because I have turned off a lot of observations it will complain that observation</span></span>
<span id="cb25-87"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="do">## input containers are not == 0, but they can&#39;t be zero so just ignore for now</span></span>
<span id="cb25-88"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="do">## this function only makes sense when you are including all the observations.</span></span>
<span id="cb25-89"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb25-89" aria-hidden="true" tabindex="-1"></a><span class="fu">validate_input_data_and_parameters</span>(data, parameters)</span></code></pre></div>
<pre><code>## [1] &quot;mu_cpue_q: different number of elements. Vector had 3 we expected 1. this is the length of &#39;ln_ll_cpue_q&#39;&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## build OM to simulate data over the historic period</span></span>
<span id="cb27-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-2" aria-hidden="true" tabindex="-1"></a>OM <span class="ot">&lt;-</span> TMB<span class="sc">::</span><span class="fu">MakeADFun</span>(<span class="at">data =</span> data,</span>
<span id="cb27-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">parameters =</span> parameters,</span>
<span id="cb27-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">map =</span> na_map,</span>
<span id="cb27-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DLL =</span> <span class="st">&quot;SpatialSablefishAssessment_TMBExports&quot;</span>, <span class="at">silent  =</span> T)</span>
<span id="cb27-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-7" aria-hidden="true" tabindex="-1"></a>first_sim_data <span class="ot">=</span> OM<span class="sc">$</span><span class="fu">simulate</span>(<span class="at">complete =</span> T)</span>
<span id="cb27-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-8" aria-hidden="true" tabindex="-1"></a>first_sim_data <span class="ot">=</span> <span class="fu">convert_simdata_integers</span>(first_sim_data, data)</span>
<span id="cb27-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="do">## visualize some of the input assumptions</span></span>
<span id="cb27-11"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_input_observations</span>(<span class="at">data =</span> first_sim_data)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_input_catches</span>(<span class="at">data =</span> first_sim_data)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-2.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_input_timeblocks</span>(<span class="at">data =</span> first_sim_data)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-3.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_comp_sample_size</span>(<span class="at">MLE_report =</span> first_sim_data, <span class="at">data =</span> first_sim_data) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-4.png" width="672" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_age_error_matrix</span>(data, F)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-5.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build an OM with the sim data</span></span>
<span id="cb32-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># useful to compare negative log likelihoods</span></span>
<span id="cb32-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># with EM&#39;s if any thing goes awry</span></span>
<span id="cb32-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-4" aria-hidden="true" tabindex="-1"></a>OM_for_report <span class="ot">&lt;-</span> TMB<span class="sc">::</span><span class="fu">MakeADFun</span>(<span class="at">data =</span> first_sim_data,</span>
<span id="cb32-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">parameters =</span> parameters,</span>
<span id="cb32-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">map =</span> na_map,</span>
<span id="cb32-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DLL =</span> <span class="st">&quot;SpatialSablefishAssessment_TMBExports&quot;</span>, <span class="at">silent  =</span> T)</span>
<span id="cb32-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-8" aria-hidden="true" tabindex="-1"></a>OM_report <span class="ot">=</span> OM_for_report<span class="sc">$</span><span class="fu">report</span>()</span>
<span id="cb32-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># have a quick look at AF fits</span></span>
<span id="cb32-10"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_AF</span>(OM_report, <span class="at">observation =</span> <span class="st">&quot;srv_dom_ll&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-6.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_AF</span>(OM_report, <span class="at">observation =</span> <span class="st">&quot;fixed_gear&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-7.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## back estimate the parameters</span></span>
<span id="cb34-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Build EM</span></span>
<span id="cb34-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="do">## we are cheating by starting at the OM parameter</span></span>
<span id="cb34-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="do">## values. Should be explored in future investigations</span></span>
<span id="cb34-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-5" aria-hidden="true" tabindex="-1"></a>EM <span class="ot">&lt;-</span> TMB<span class="sc">::</span><span class="fu">MakeADFun</span>(<span class="at">data =</span> first_sim_data,</span>
<span id="cb34-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">parameters =</span> parameters,</span>
<span id="cb34-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">map =</span> na_map,</span>
<span id="cb34-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DLL =</span> <span class="st">&quot;SpatialSablefishAssessment_TMBExports&quot;</span>, <span class="at">silent  =</span> T)</span>
<span id="cb34-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">names</span>(EM<span class="sc">$</span>par))</span></code></pre></div>
<pre><code>##  [1] &quot;ln_mean_rec&quot;            &quot;ln_rec_dev&quot;             &quot;ln_ll_sel_pars&quot;        
##  [4] &quot;ln_trwl_sel_pars&quot;       &quot;ln_ll_F_avg&quot;            &quot;ln_ll_F_devs&quot;          
##  [7] &quot;ln_trwl_F_avg&quot;          &quot;ln_trwl_F_devs&quot;         &quot;ln_srv_dom_ll_q&quot;       
## [10] &quot;ln_srv_dom_ll_sel_pars&quot;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## estimate</span></span>
<span id="cb36-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb36-2" aria-hidden="true" tabindex="-1"></a>first_MLE <span class="ot">=</span> <span class="fu">nlminb</span>(<span class="at">start =</span> EM<span class="sc">$</span>par, <span class="at">objective =</span> EM<span class="sc">$</span>fn, <span class="at">gradient  =</span> EM<span class="sc">$</span>gr, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">eval.max =</span> <span class="dv">1000</span>, <span class="at">iter.max =</span> <span class="dv">1000</span>))</span>
<span id="cb36-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check parameter with largest gradient after initial optimization</span></span>
<span id="cb36-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; par &quot;</span>, <span class="fu">names</span>(EM<span class="sc">$</span>par)[<span class="fu">which.max</span>(EM<span class="sc">$</span><span class="fu">gr</span>())], <span class="st">&quot; had largest gradient = &quot;</span>, EM<span class="sc">$</span><span class="fu">gr</span>()[<span class="fu">which.max</span>(EM<span class="sc">$</span><span class="fu">gr</span>())], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##  par  ln_mean_rec  had largest gradient =  0.01585097</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## do an additional two Newton Raphson iterations to try and improve the fit.</span></span>
<span id="cb38-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## this will also check that the Hessian is well defined because it is needed</span></span>
<span id="cb38-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## to do the Newton Raphson iterations</span></span>
<span id="cb38-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-4" aria-hidden="true" tabindex="-1"></a>try_improve <span class="ot">=</span> <span class="fu">tryCatch</span>(<span class="at">expr =</span></span>
<span id="cb38-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-5" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb38-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-6" aria-hidden="true" tabindex="-1"></a>                           g <span class="ot">=</span> <span class="fu">as.numeric</span>(EM<span class="sc">$</span><span class="fu">gr</span>(first_MLE<span class="sc">$</span>par))</span>
<span id="cb38-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-7" aria-hidden="true" tabindex="-1"></a>                           h <span class="ot">=</span> <span class="fu">optimHess</span>(first_MLE<span class="sc">$</span>par, <span class="at">fn =</span> EM<span class="sc">$</span>fn, <span class="at">gr =</span> EM<span class="sc">$</span>gr)</span>
<span id="cb38-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-8" aria-hidden="true" tabindex="-1"></a>                           first_MLE<span class="sc">$</span>par <span class="ot">=</span> first_MLE<span class="sc">$</span>par <span class="sc">-</span> <span class="fu">solve</span>(h,g)</span>
<span id="cb38-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-9" aria-hidden="true" tabindex="-1"></a>                           first_MLE<span class="sc">$</span>objective <span class="ot">=</span> EM<span class="sc">$</span><span class="fu">fn</span>(first_MLE<span class="sc">$</span>par)</span>
<span id="cb38-10"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-10" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb38-11"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-11" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">error =</span> <span class="cf">function</span>(e){e}, <span class="at">warning =</span> <span class="cf">function</span>(w){w})</span>
<span id="cb38-12"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">inherits</span>(try_improve, <span class="st">&quot;error&quot;</span>) <span class="sc">|</span> <span class="fu">inherits</span>(try_improve, <span class="st">&quot;warning&quot;</span>)) {</span>
<span id="cb38-14"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;didn&#39;t converge!!!</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb38-15"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## investigate further</span></span>
<span id="cb38-16"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-17"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="do">## else get derived quantities</span></span>
<span id="cb38-18"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-18" aria-hidden="true" tabindex="-1"></a>mle_report <span class="ot">=</span> EM<span class="sc">$</span><span class="fu">report</span>(first_MLE<span class="sc">$</span>par)</span>
<span id="cb38-19"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="do">## save in a named list so we can use the get_multiple accessors</span></span>
<span id="cb38-20"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-20" aria-hidden="true" tabindex="-1"></a>mod_lst <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb38-21"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-21" aria-hidden="true" tabindex="-1"></a>mod_lst[[<span class="st">&quot;OM&quot;</span>]] <span class="ot">=</span> OM_report</span>
<span id="cb38-22"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-22" aria-hidden="true" tabindex="-1"></a>mod_lst[[<span class="st">&quot;EM&quot;</span>]] <span class="ot">=</span> mle_report</span>
<span id="cb38-23"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="do">## you can skip this part if you want to look at the</span></span>
<span id="cb38-24"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="do">## harvest control work</span></span>
<span id="cb38-25"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="do">## do a bunch of model comparisons</span></span>
<span id="cb38-26"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co"># get likelihoods</span></span>
<span id="cb38-27"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-27" aria-hidden="true" tabindex="-1"></a>nlls <span class="ot">=</span> <span class="fu">get_multiple_nlls</span>(<span class="at">mle_ls =</span> mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb38-28"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-28" aria-hidden="true" tabindex="-1"></a>nll_wider <span class="ot">=</span> nlls <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> observations, <span class="at">names_from =</span> label, <span class="at">values_from =</span> negloglike) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">abs</span>(OM <span class="sc">-</span> EM))</span>
<span id="cb38-29"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nll_wider, <span class="at">n =</span> <span class="dv">24</span>)</span></code></pre></div>
<pre><code>## # A tibble: 29 x 4
##    observations                               OM         EM    diff
##    &lt;chr&gt;                                   &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 fishery-ll-age_comp                   14917.  14911.      6.35  
##  2 fishery-trwl-male_length_comp         13551.  13549.      2.43  
##  3 fishery-trwl-female_length_comp       15183.  15179.      3.76  
##  4 srv-Domestic-ll_index                   214.    214.      0.437 
##  5 srv-Japanese-ll_index                     0       0       0     
##  6 fishery-ll_index                          0       0       0     
##  7 srv-Domestic-ll-age_comp              19864.  19848.     16.0   
##  8 srv-Domestic-ll-male_length_comp      17912.  17913.      0.818 
##  9 srv-Domestic-ll-female_length_comp    20164.  20160.      4.86  
## 10 srv-Japanese-ll-age_comp                  0       0       0     
## 11 srv-Japanese-ll-male_length_comp          0       0       0     
## 12 srv-Japanese-ll-female_length_comp        0       0       0     
## 13 srv-GOA-trwl-age_comp                     0       0       0     
## 14 srv-GOA-trwl-male_length_comp             0       0       0     
## 15 srv-GOA-trwl-female_length_comp           0       0       0     
## 16 fishery-ll-male_length_comp           13085.  13083.      1.50  
## 17 fishery-ll-female_length_comp         14916.  14915.      0.997 
## 18 srv-GOA-trwl-index                        0       0       0     
## 19 Historic-Japanese-Fishery-index           0       0       0     
## 20 Historic-Japanese-Fishery-length_comp     0       0       0     
## 21 fishery-ll-catch_Sum_of_squares           0       0.0095  0.0095
## 22 fishery-trwlcatch_Sum_of_squares          0       0.0118  0.0118
## 23 Recruitment-penalty                      27.6    29.0     1.34  
## 24 Longline_F_penalty                       35.9    36.8     0.838 
## # i 5 more rows</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot initial age</span></span>
<span id="cb40-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb40-2" aria-hidden="true" tabindex="-1"></a>init_age <span class="ot">=</span> <span class="fu">get_multiple_init_nage</span>(<span class="at">mle_ls =</span> mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb40-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(init_age, <span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> Numbers, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb40-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sex) <span class="sc">+</span></span>
<span id="cb40-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-8.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot SSBs</span></span>
<span id="cb41-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb41-2" aria-hidden="true" tabindex="-1"></a>ssbs <span class="ot">=</span> <span class="fu">get_multiple_ssbs</span>(mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst), <span class="at">depletion =</span> F)</span>
<span id="cb41-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ssbs, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> SSB, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb41-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-9.png" width="672" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot catch</span></span>
<span id="cb42-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-2" aria-hidden="true" tabindex="-1"></a>catch <span class="ot">=</span> <span class="fu">get_multiple_catch_fits</span>(mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb42-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> catch <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;Observed&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Catch, <span class="at">shape =</span> label), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> catch <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;Predicted&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Catch, <span class="at">col =</span> label, <span class="at">linetype =</span> label), <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb42-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Fishery)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-10.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot recruitment</span></span>
<span id="cb43-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb43-2" aria-hidden="true" tabindex="-1"></a>recruits <span class="ot">=</span> <span class="fu">get_multiple_recruits</span>(mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb43-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(recruits, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Recruitment, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-11.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(recruits, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Recruitment_deviation, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb44-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-12.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Selectivities</span></span>
<span id="cb45-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb45-2" aria-hidden="true" tabindex="-1"></a>select_df <span class="ot">=</span> <span class="fu">get_multiple_selectivities</span>(<span class="at">mle_ls =</span> mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb45-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(select_df, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> value, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb45-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb45-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(gear<span class="sc">~</span>sex) <span class="sc">+</span></span>
<span id="cb45-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-13.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot index_fit</span></span>
<span id="cb46-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb46-2" aria-hidden="true" tabindex="-1"></a>index_df <span class="ot">=</span> <span class="fu">get_multiple_index_fits</span>(mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb46-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> index_df, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Pearsons_residuals, <span class="at">col =</span> label, <span class="at">shape =</span> label)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span> <span class="fl">1.4</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation) <span class="sc">+</span></span>
<span id="cb46-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-14.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> index_df, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Predicted, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb47-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb47-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation) <span class="sc">+</span></span>
<span id="cb47-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-15.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> index_df, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Observed, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb48-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb48-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>observation) <span class="sc">+</span></span>
<span id="cb48-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-16.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb49-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Apply a constant F-rule</span></span>
<span id="cb49-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Simulate data forward 3 years</span></span>
<span id="cb49-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="do">## I am going to repeat this twice, but you may want to</span></span>
<span id="cb49-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="do">## add this into a for loop</span></span>
<span id="cb49-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="do">## and re-estimate SSB based on F-rule</span></span>
<span id="cb49-7"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="do">## This would be an MSE like piece of code</span></span>
<span id="cb49-8"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb49-9"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-10" aria-hidden="true" tabindex="-1"></a>n_future_years <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb49-11"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-11" aria-hidden="true" tabindex="-1"></a>avg_ll_F_last_5_years <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">tail</span>(mle_report<span class="sc">$</span>annual_F_ll, <span class="at">n =</span> <span class="dv">5</span>))</span>
<span id="cb49-12"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-12" aria-hidden="true" tabindex="-1"></a>avg_trwl_F_last_5_years <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">tail</span>(mle_report<span class="sc">$</span>annual_F_trwl, <span class="at">n =</span> <span class="dv">5</span>))</span>
<span id="cb49-13"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-13" aria-hidden="true" tabindex="-1"></a>Fmsy <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb49-14"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="do">## a simple harvest control rule</span></span>
<span id="cb49-15"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="do">## if average F in last 5 years is greater than Fmsy</span></span>
<span id="cb49-16"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="do">## half the average F for future years</span></span>
<span id="cb49-17"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="do">## else set to F-msy</span></span>
<span id="cb49-18"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb49-21"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1 simulate 3 years of future data</span></span>
<span id="cb49-22"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="do">## based on HCR</span></span>
<span id="cb49-23"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb49-24"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-24" aria-hidden="true" tabindex="-1"></a>future_ll_Fs <span class="ot">=</span> future_trwl_Fs <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb49-25"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(avg_ll_F_last_5_years <span class="sc">&gt;</span> Fmsy) {</span>
<span id="cb49-26"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-26" aria-hidden="true" tabindex="-1"></a>  future_ll_Fs <span class="ot">=</span>  <span class="fu">rep</span>(avg_ll_F_last_5_years <span class="sc">/</span> <span class="dv">2</span>, n_future_years)</span>
<span id="cb49-27"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-27" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb49-28"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-28" aria-hidden="true" tabindex="-1"></a>  future_ll_Fs <span class="ot">=</span> <span class="fu">rep</span>(Fmsy, n_future_years)</span>
<span id="cb49-29"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-30"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(avg_trwl_F_last_5_years <span class="sc">&gt;</span> Fmsy) {</span>
<span id="cb49-31"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-31" aria-hidden="true" tabindex="-1"></a>  future_trwl_Fs <span class="ot">=</span> <span class="fu">rep</span>(avg_trwl_F_last_5_years <span class="sc">/</span> <span class="dv">2</span>, n_future_years)</span>
<span id="cb49-32"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-32" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb49-33"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-33" aria-hidden="true" tabindex="-1"></a>  future_trwl_Fs <span class="ot">=</span>  <span class="fu">rep</span>(Fmsy, n_future_years)</span>
<span id="cb49-34"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-35"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="co"># get MLE parameters in list form so we can feed it to MakeADFun</span></span>
<span id="cb49-36"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-36" aria-hidden="true" tabindex="-1"></a>mle_param_list <span class="ot">=</span> EM<span class="sc">$</span>env<span class="sc">$</span><span class="fu">parList</span>(<span class="at">par =</span> first_MLE<span class="sc">$</span>par)</span>
<span id="cb49-37"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-37" aria-hidden="true" tabindex="-1"></a>new_sim_data <span class="ot">=</span> <span class="fu">simulate_future_data</span>(<span class="at">data =</span> first_sim_data, <span class="at">parameters =</span> mle_param_list,</span>
<span id="cb49-38"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-38" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">n_future_years =</span> n_future_years,</span>
<span id="cb49-39"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-39" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">future_ll_Fs =</span> future_ll_Fs, <span class="at">future_trwl_Fs =</span> future_trwl_Fs)</span>
<span id="cb49-40"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="do">## update na_map we have more F&#39;s and rec devs so need to account for that in the map parameter</span></span>
<span id="cb49-41"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-41" aria-hidden="true" tabindex="-1"></a>na_map <span class="ot">=</span> <span class="fu">fix_pars</span>(<span class="at">par_list =</span> new_sim_data<span class="sc">$</span>future_parameters, <span class="at">pars_to_exclude =</span> <span class="fu">unique</span>(<span class="fu">names</span>(parameters))[<span class="sc">!</span><span class="fu">unique</span>(<span class="fu">names</span>(parameters)) <span class="sc">%in%</span> estimated_pars])</span>
<span id="cb49-42"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-42" aria-hidden="true" tabindex="-1"></a><span class="do">## need to rejig future_data becaue it would have added simulated data for</span></span>
<span id="cb49-43"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="do">## observations that we have turned off</span></span>
<span id="cb49-44"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-44" aria-hidden="true" tabindex="-1"></a>future_data <span class="ot">=</span> new_sim_data<span class="sc">$</span>future_data</span>
<span id="cb49-45"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-45" aria-hidden="true" tabindex="-1"></a>new_n_projyears <span class="ot">=</span> <span class="fu">length</span>(future_data<span class="sc">$</span>srv_jap_ll_bio_indicator)</span>
<span id="cb49-46"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-46" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_ll_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-47"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-47" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_nmfs_trwl_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-48"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-48" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>ll_cpue_indicator  <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-49"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-49" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_fishery_ll_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-50"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-50" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_ll_age_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-51"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-51" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_ll_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-52"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-52" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_fishery_ll_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-53"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-53" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_nmfs_trwl_age_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-54"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-54" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_nmfs_trwl_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-55"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="do">## Re-estimate</span></span>
<span id="cb49-56"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-56" aria-hidden="true" tabindex="-1"></a>EM_future <span class="ot">&lt;-</span> TMB<span class="sc">::</span><span class="fu">MakeADFun</span>(<span class="at">data =</span> future_data,</span>
<span id="cb49-57"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">parameters =</span> new_sim_data<span class="sc">$</span>future_parameters,</span>
<span id="cb49-58"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">map =</span> na_map,</span>
<span id="cb49-59"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-59" aria-hidden="true" tabindex="-1"></a>                     <span class="at">DLL =</span> <span class="st">&quot;SpatialSablefishAssessment_TMBExports&quot;</span>, <span class="at">silent  =</span> T)</span>
<span id="cb49-60"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-60" aria-hidden="true" tabindex="-1"></a>mle_future <span class="ot">=</span> <span class="fu">nlminb</span>(<span class="at">start =</span> EM_future<span class="sc">$</span>par, <span class="at">objective =</span> EM_future<span class="sc">$</span>fn, <span class="at">gradient  =</span> EM_future<span class="sc">$</span>gr, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">eval.max =</span> <span class="dv">1000</span>, <span class="at">iter.max =</span> <span class="dv">1000</span>))</span>
<span id="cb49-61"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-61" aria-hidden="true" tabindex="-1"></a>mle_future_report <span class="ot">=</span> EM_future<span class="sc">$</span><span class="fu">report</span>(mle_future<span class="sc">$</span>par)</span>
<span id="cb49-62"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-62" aria-hidden="true" tabindex="-1"></a>mod_lst[[<span class="st">&quot;EM_future-1&quot;</span>]] <span class="ot">=</span> mle_future_report</span>
<span id="cb49-63"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-64"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-64" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb49-65"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-65" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2 simulate another 3 years of future data</span></span>
<span id="cb49-66"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="do">## on top of the previous 3 years of future data</span></span>
<span id="cb49-67"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="do">## based on HCR</span></span>
<span id="cb49-68"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-68" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb49-69"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-69" aria-hidden="true" tabindex="-1"></a><span class="do">## Repeat the Harvest control rule for another 3 years</span></span>
<span id="cb49-70"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-70" aria-hidden="true" tabindex="-1"></a>avg_ll_F_last_5_years <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">tail</span>(mle_future_report<span class="sc">$</span>annual_F_ll, <span class="at">n =</span> <span class="dv">5</span>))</span>
<span id="cb49-71"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-71" aria-hidden="true" tabindex="-1"></a>avg_trwl_F_last_5_years <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">tail</span>(mle_future_report<span class="sc">$</span>annual_F_trwl, <span class="at">n =</span> <span class="dv">5</span>))</span>
<span id="cb49-72"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-72" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(avg_ll_F_last_5_years <span class="sc">&gt;</span> Fmsy) {</span>
<span id="cb49-73"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-73" aria-hidden="true" tabindex="-1"></a>  future_ll_Fs <span class="ot">=</span>  <span class="fu">rep</span>(avg_ll_F_last_5_years <span class="sc">/</span> <span class="dv">2</span>, n_future_years)</span>
<span id="cb49-74"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-74" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb49-75"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-75" aria-hidden="true" tabindex="-1"></a>  future_ll_Fs <span class="ot">=</span> <span class="fu">rep</span>(Fmsy, n_future_years)</span>
<span id="cb49-76"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-77"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-77" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(avg_trwl_F_last_5_years <span class="sc">&gt;</span> Fmsy) {</span>
<span id="cb49-78"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-78" aria-hidden="true" tabindex="-1"></a>  future_trwl_Fs <span class="ot">=</span> <span class="fu">rep</span>(avg_trwl_F_last_5_years <span class="sc">/</span> <span class="dv">2</span>, n_future_years)</span>
<span id="cb49-79"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-79" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb49-80"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-80" aria-hidden="true" tabindex="-1"></a>  future_trwl_Fs <span class="ot">=</span>  <span class="fu">rep</span>(Fmsy, n_future_years)</span>
<span id="cb49-81"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-82"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-82" aria-hidden="true" tabindex="-1"></a><span class="co"># get MLE parameters in list form so we can feed it to MakeADFun</span></span>
<span id="cb49-83"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-83" aria-hidden="true" tabindex="-1"></a>mle_param_list <span class="ot">=</span> EM_future<span class="sc">$</span>env<span class="sc">$</span><span class="fu">parList</span>(<span class="at">par =</span> mle_future<span class="sc">$</span>par)</span>
<span id="cb49-84"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-84" aria-hidden="true" tabindex="-1"></a>new_sim_data <span class="ot">=</span> <span class="fu">simulate_future_data</span>(<span class="at">data =</span> future_data, <span class="at">parameters =</span> mle_param_list,</span>
<span id="cb49-85"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-85" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">n_future_years =</span> n_future_years,</span>
<span id="cb49-86"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-86" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">future_ll_Fs =</span> future_ll_Fs, <span class="at">future_trwl_Fs =</span> future_trwl_Fs)</span>
<span id="cb49-87"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-87" aria-hidden="true" tabindex="-1"></a><span class="do">## update na_map we have more F&#39;s and rec devs so need to account for that in the map parameter</span></span>
<span id="cb49-88"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-88" aria-hidden="true" tabindex="-1"></a>na_map <span class="ot">=</span> <span class="fu">fix_pars</span>(<span class="at">par_list =</span> new_sim_data<span class="sc">$</span>future_parameters, <span class="at">pars_to_exclude =</span> <span class="fu">unique</span>(<span class="fu">names</span>(parameters))[<span class="sc">!</span><span class="fu">unique</span>(<span class="fu">names</span>(parameters)) <span class="sc">%in%</span> estimated_pars])</span>
<span id="cb49-89"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-89" aria-hidden="true" tabindex="-1"></a><span class="do">## need to rejig future_data becaue it would have added simulated data for</span></span>
<span id="cb49-90"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-90" aria-hidden="true" tabindex="-1"></a><span class="do">## observations that we have turned off</span></span>
<span id="cb49-91"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-91" aria-hidden="true" tabindex="-1"></a>future_data <span class="ot">=</span> new_sim_data<span class="sc">$</span>future_data</span>
<span id="cb49-92"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-92" aria-hidden="true" tabindex="-1"></a>new_n_projyears <span class="ot">=</span> <span class="fu">length</span>(future_data<span class="sc">$</span>srv_jap_ll_bio_indicator)</span>
<span id="cb49-93"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-93" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_ll_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-94"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-94" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_nmfs_trwl_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-95"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-95" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>ll_cpue_indicator  <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-96"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-96" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_fishery_ll_bio_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-97"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-97" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_ll_age_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-98"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-98" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_ll_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-99"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-99" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_jap_fishery_ll_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-100"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-100" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_nmfs_trwl_age_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-101"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-101" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>srv_nmfs_trwl_lgth_indicator <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, new_n_projyears)</span>
<span id="cb49-102"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-102" aria-hidden="true" tabindex="-1"></a><span class="do">## Re-estimate</span></span>
<span id="cb49-103"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-103" aria-hidden="true" tabindex="-1"></a>EM_future <span class="ot">&lt;-</span> TMB<span class="sc">::</span><span class="fu">MakeADFun</span>(<span class="at">data =</span> future_data,</span>
<span id="cb49-104"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-104" aria-hidden="true" tabindex="-1"></a>                            <span class="at">parameters =</span> new_sim_data<span class="sc">$</span>future_parameters,</span>
<span id="cb49-105"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-105" aria-hidden="true" tabindex="-1"></a>                            <span class="at">map =</span> na_map,</span>
<span id="cb49-106"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-106" aria-hidden="true" tabindex="-1"></a>                            <span class="at">DLL =</span> <span class="st">&quot;SpatialSablefishAssessment_TMBExports&quot;</span>, <span class="at">silent  =</span> T)</span>
<span id="cb49-107"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-107" aria-hidden="true" tabindex="-1"></a>mle_future <span class="ot">=</span> <span class="fu">nlminb</span>(<span class="at">start =</span> EM_future<span class="sc">$</span>par, <span class="at">objective =</span> EM_future<span class="sc">$</span>fn, <span class="at">gradient  =</span> EM_future<span class="sc">$</span>gr, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">eval.max =</span> <span class="dv">1000</span>, <span class="at">iter.max =</span> <span class="dv">1000</span>))</span>
<span id="cb49-108"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-108" aria-hidden="true" tabindex="-1"></a>mle_future_report <span class="ot">=</span> EM_future<span class="sc">$</span><span class="fu">report</span>(mle_future<span class="sc">$</span>par)</span>
<span id="cb49-109"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-109" aria-hidden="true" tabindex="-1"></a>mod_lst[[<span class="st">&quot;EM_future-2&quot;</span>]] <span class="ot">=</span> mle_future_report</span>
<span id="cb49-110"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-110" aria-hidden="true" tabindex="-1"></a>mod_lst[[<span class="st">&quot;OM&quot;</span>]] <span class="ot">=</span> new_sim_data<span class="sc">$</span>sim_data</span>
<span id="cb49-111"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-111" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb49-112"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-112" aria-hidden="true" tabindex="-1"></a><span class="do">## visually compare the estimated</span></span>
<span id="cb49-113"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-113" aria-hidden="true" tabindex="-1"></a><span class="do">## SSB through the 2 MSE steps</span></span>
<span id="cb49-114"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-114" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb49-115"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-115" aria-hidden="true" tabindex="-1"></a><span class="do">## look at ssbs</span></span>
<span id="cb49-116"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-116" aria-hidden="true" tabindex="-1"></a><span class="do">## plot SSBs</span></span>
<span id="cb49-117"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-117" aria-hidden="true" tabindex="-1"></a>ssbs <span class="ot">=</span> <span class="fu">get_multiple_ssbs</span>(mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst), <span class="at">depletion =</span> F)</span>
<span id="cb49-118"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-118" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ssbs, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> SSB, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb49-119"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb49-120"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-121"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb49-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">2010</span>, <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-17.png" width="672" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb50-1" aria-hidden="true" tabindex="-1"></a>Fs <span class="ot">=</span> <span class="fu">get_multiple_Fs</span>(mod_lst, <span class="at">run_labels =</span> <span class="fu">names</span>(mod_lst))</span>
<span id="cb50-2"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Fs, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> F, <span class="at">col =</span> label, <span class="at">linetype =</span> label)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-5"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Fishery) <span class="sc">+</span></span>
<span id="cb50-6"><a href="how-to-use-spatialsablefishassessment-in-a-mse.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">2010</span>, <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/MSE-18.png" width="672" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="assessment-data-and-parameter-descriptions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="adding-unit-tests.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Craig44/SpatialSablefishAssessment/edit/main/06-MSE.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
