[["index.html", "SpatialSablefishAssessment Chapter 1 SpatialSablefishAssessment is a R package for conducting spatial stock assessment research for a stock that has two fisheries.", " SpatialSablefishAssessment C.Marsh 2023-01-02 Chapter 1 SpatialSablefishAssessment is a R package for conducting spatial stock assessment research for a stock that has two fisheries. library(TMB) library(SpatialSablefishAssessment) #devtools::install_github(&quot;Craig44/SpatialSablefishAssessment&quot;) library(ggplot2) library(dplyr) "],["functionlist.html", "Chapter 2 A list of functions available in the SpatialSablefishAssessment package 2.1 Validate functions 2.2 Accessor functions 2.3 Plotting functions 2.4 Estimation functions 2.5 Parameter transformation functions", " Chapter 2 A list of functions available in the SpatialSablefishAssessment package All of these functions have descriptions and details on expected input parameters using the standard ? R query methods. You can also use help(package = \"SpatialSablefishAssessment\") to get a list of functions available in this package. 2.1 Validate functions validate_input_data_and_parameters This should always be run before TMB::MakeADFun 2.2 Accessor functions get_AF get age-frequency observed and predicted values from a model get_LF get length-frequency observed and predicted values from a model get_catches get observed and predicted catches from a fitted model get_fishing_mortalities get annual fishing mortalities from a model get_index get survey index from a model get_partition get numbers at age (units 000s) from a fitted model get_SSB get SSBS (kilo tonnes 000s) from a fitted model get_tag_recovery_obs_fitted_values get_tag_release_AF get age-frequency of tag-releases get_negloglike get negative loglikelihoods for each contribution 2.3 Plotting functions plot_AF plot age frequency observation plot_age_length_matrix plot input age-length transition matrices plot_catch_fit plot the fit to catches plot_fishing_mortalities plot fishing mortalities plot_frequency_of_tag_release_and_recoveries plot_index_fit plot survey index plot_init_nage plot initial numbers at age plot_input_catches plot input catches plot_input_observations plot input observations plot_LF plot length frequency observation plot_mean_age plot mean age observations plot_mean_length plot mean length observations plot_mean_weight plot mean weight over time for males and females plot_movement plot movement matrix from a model plot_partition plot_recruitment plot_selectivities plot_SSB plot_tag_recovery_obs plot_tag_release_AF plot_partition 2.4 Estimation functions set_up_parameters Fix parameters, uses fix_pars and set_pars_to_be_the_same for the TagIntegrated model check_gradients check all parameter gradients are not zero Francis_reweighting calculate stage-two weights for composition data get_tmb_fixed_effects return fixed effect parameters from a model fix_pars turn off parameters so they arent estimated, there are many parameters that shouldnt be estimated set_pars_to_be_the_same set parameters to be estimated at the same value i.e., male female have the same selectivity parameters. or tag-reporting to be the same among regions. rmvnorm_prec simulate from a multivariate normal distribution using the precision matrix. 2.5 Parameter transformation functions restoresimplex go from simplex to unit vector simplex go from unit vector to simplex logit_general logistic transformation between a specified lower and upper bound logit logistic transformation between 0, 1 similar to qlogis invlogit_general inverse logistic transformation between a specified lower and upper bound invlogit inverse logistic transformation between 0, 1 similar to plogis bound_unit transform a parameter \\(X\\) bound between -1 and 1 (i.e., correlation parameter) as \\[ Y = \\begin{cases} \\sqrt{\\frac{X^2}{1 - X^2}}, \\ \\ &amp; X \\geq 0 \\\\ -\\sqrt{\\frac{X^2}{1 - X^2}} , \\ \\ &amp; X &lt; 0 \\end{cases} \\] inv_bound_unit inverse of bound_unit gm_mean calculate the geometric mean log_cv calculate cv for the lognormal distribution given standard deviation log_sigma calculate standard deviation for the lognormal distribution given CV lognormal_CI calculate confidence intervals for the lognormal distribution "],["how-to-use-spatialsablefishassessment.html", "Chapter 3 How to use SpatialSablefishAssessment 3.1 Configuring and checking model inputs (data and parameters) 3.2 Optimisation 3.3 Model Summary", " Chapter 3 How to use SpatialSablefishAssessment 3.1 Configuring and checking model inputs (data and parameters) This package contains TMB models and summarizing and plotting functions for a spatial model used in sablefish research. Users are responsible for configuring the data and parameter structures that are passed to the TMB MakeADFun function which compiles the model. The best place to look for what dimensions and names of expected elements for data and parameter it is best to look at an example or the source code for the model (see here). To view an example data run load(system.file(&quot;testdata&quot;, &quot;MockSablefishModel.RData&quot;,package=&quot;SpatialSablefishAssessment&quot;)) names(data) names(parameters) region_key Once you have built the data and parameter objects then you can check that the dimensions are consistent with the model by using, validate_input_data_and_parameters(data, parameters) This function will report a message telling you either success or if one of the objects dimensions are off, then you will need to fix this because it is likely if you pass this to the TMBs MakeADFun it will crash your R session. The following list are some useful utility functions contained in this package to visualize data inputs. All functions should be documented and queried using the usual R ? method plot_input_observations plot_input_catches plot_mean_weight plot_age_length_matrix Once you have checked the data and parameter objects you can build the TMB model following, my_model = TMB::MakeADFun(data = data, parameters = parameters, DLL = &quot;SpatialSablefishAssessment_TMBExports&quot;, silent = T) 3.1.1 Simple sanity checks It is possible to configure a model that has zero gradients for parameters, and you want to check this is not the case using the check_gradients(my_model) Check the likelihoods are all finite. It is easy to ask the model to calculate a predicted value in a region or year that has no fish which can cause undefined behaviour in some likelihood functions. if(!all(is.finite(my_model$report()$nll))) print(&quot;Found Inf in log-likelihood, you will need to resolve this before optimisation&quot;) if(!all(!is.na(my_model$report()$nll))) print(&quot;Found NA in log-likelihood, you will need to resolve this before optimisation&quot;) 3.2 Optimisation mle_optim = nlminb(start = my_model$par, objective = my_model$fn, gradient = my_model$gr, control = list(iter.max = 10000, eval.max = 10000)) # Try and improve the optimsation running the model for two additional Newton Raphson iterations try_improve = tryCatch(expr = for(i in 1:2) { g = as.numeric(my_model$gr(mle_optim$par)) h = optimHess(mle_spatial$par, fn = my_model$fn, gr = my_model$gr) mle_optim$par = mle_spatial$par - solve(h,g) mle_optim$objective = my_model$fn(mle_optim$par) } , error = function(e){e}) try_improve 3.2.1 Check convergence ## largest gradient names(mle_optim$par)[which.max(abs(my_model$gr(mle_optim$par)))] 3.2.2 Fixing estimable parameters at input values ?fix_pars() 3.2.3 Sharing parameter estimates among estimable variables i.e., male and female having a common selectivity ?set_pars_to_be_the_same() 3.3 Model Summary Once you are satisfied that the model has converged at global minimum, then you can get the model to report model quantities ## get MLE quantities mle_report = my_model$report(mle_optim$par) ######### ## Plot interesting ## Model quantities i.e., recruitment SSBs model fits etc ######### ## movement assumption plot_movement(mle_report, region_key = region_key) # starting values plot_movement(OM_report, region_key) # plot selectivities plot_selectivities(mle_report) # starting values plot_selectivities(OM_report) ## Regional SSBs ssb_plt = plot_SSB(mle_report, region_key = region_key) ssb_plt ## sum SSB over all regions ggplot(ssb_plt$data %&gt;% group_by(Year) %&gt;% summarise(total_ssb = sum(SSB)), aes(x = Year, y = total_ssb)) + geom_line(linewidth = 1.1) + ylim(0,NA) ## plot F&#39;s plot_fishing_mortalities(MLE_report = mle_report, region_key = region_key) ## plot fits to observations # catch and index plot_catch_fit(MLE_report = mle_report, region_key = region_key) + facet_wrap(label~Region, ncol = n_regions) + ylab(&quot;Catch (mt)&quot;) plot_index_fit(MLE_report = mle_report, region_key = region_key) # survey AFs first_year_set = c(1981, seq(from = 1985, to = 1993, by = 2), 1996:1999) plot_AF(MLE_report = mle_report, region_key = region_key, label = &quot;srv_dom_ll&quot;, subset_years = first_year_set, sex = &quot;male&quot;) + ggtitle(&quot;Male survey AF&quot;) + guides(shape = &quot;none&quot;, linetype = &quot;none&quot;) + ylim(0,20) plot_AF(MLE_report = mle_report, region_key = region_key, label = &quot;srv_dom_ll&quot;, subset_years = first_year_set, sex = &quot;female&quot;) + ggtitle(&quot;Female survey AF&quot;) + guides(shape = &quot;none&quot;, linetype = &quot;none&quot;) # fishery LFs # Fixed gear plot_LF(MLE_report = mle_report, region_key = region_key, label = &quot;fixed&quot;, subset_years = 1991:1999, sex = &quot;male&quot;) + ggtitle(&quot;Male fixed LF&quot;) + guides(shape = &quot;none&quot;, linetype = &quot;none&quot;) plot_LF(MLE_report = mle_report, region_key = region_key, label = &quot;fixed&quot;, subset_years = 1991:1999, sex = &quot;female&quot;) + ggtitle(&quot;Female fixed LF&quot;) + guides(shape = &quot;none&quot;, linetype = &quot;none&quot;) # plot by tag releases event tag_fits_by_age_sex = get_tag_recovery_obs_fitted_values(mle_report, region_key = region_key) tag_fits = tag_fits_by_age_sex %&gt;% group_by(release_event, unique_recovery_id) %&gt;% summarise(observed = sum(observed), predicted = sum(predicted), recovery_year = unique(recovery_year), recovery_region = unique(recovery_region), release_region = unique(release_region), release_year = unique(release_year)) tag_fits$resid = tag_fits$observed - tag_fits$predicted tag_fits$stand_resid = tag_fits$resid / tag_fits$predicted tag_fits$resid_sign = ifelse(tag_fits$resid &lt; 0, &quot;negative&quot;, &quot;positive&quot;) unique_release_events = unique(tag_fits$release_event) gplt = ggplot(tag_fits %&gt;% filter(release_event %in% unique_release_events[1:16]), aes(x = recovery_year, y = recovery_region)) + geom_point(aes(size = abs(stand_resid), col = resid_sign)) + labs(x = &quot;Recovery year&quot;, y = &quot;Recovery region&quot;, size = &quot;Pearson residuals&quot;) + theme_bw() + scale_size_area() + facet_wrap(~release_event) + scale_x_discrete(breaks = every_nth(n = 5)) "],["TagIntegratedEq.html", "Chapter 4 TagIntegrated model equations Process equations Observation equations Symbol Notation", " Chapter 4 TagIntegrated model equations Process equations Population dynamics The order of processes in an annual cycle follow recruitment and release of tagged fish (we apply initial tag induced mortality here), total mortality and ageing, markovian movement annual tag shedding (applied as a mortality process), Before movement, the partition is updated following \\[\\begin{align*} N_{a,r,y,s} = \\begin{cases} R_{r,y} 0.5, &amp; a = a_1\\\\ N_{a - 1,r,y - 1,s} \\exp\\bigg( -Z_{a - 1,r, y - 1,s} \\bigg), &amp; a_1 &lt; a &lt; a_+\\\\ N_{a - 1,r,y - 1,s} \\exp\\bigg( -Z_{a - 1,r, y - 1,s} \\bigg) + N_{a,r,y - 1,s} \\exp\\bigg( -Z_{a,r, y - 1,s} \\bigg), &amp; a = a_+ \\end{cases} \\end{align*}\\] and movement is then applied \\[\\begin{equation*} \\boldsymbol{N}&#39;_{a,y,s} = \\boldsymbol{N}_{a,y,s} \\boldsymbol{M} \\ \\ \\forall \\ a \\end{equation*}\\] where, \\(\\boldsymbol{N}&#39;_{a,y,s} = (N&#39;_{a,1,y,s}, \\dots, N&#39;_{a,n_r,y,s})\\) denotes the numbers for age \\(a\\) across all regions after movement and \\(\\boldsymbol{M}\\) is an \\(n_r \\times n_r\\) movement matrix, which will move age cohort \\(a\\) among the regions based on the movement matrix. Initialisation An equilibrium age structure is derived by iterating the annual cycle is run \\(n_a - 1\\) times (i.e., to populate all age cohorts prior to the plus group). Then, iterate the annual cycle one more time and calculate the number of individuals that moved into each regions plus age cohort, denoted by \\(c^r_{a+}\\). This will be the result of ageing, mortality and movement. The equilibrium plus group for region \\(r\\) is then calculated as \\[ N_{a+, r} = N_{a+ - 1, r} \\frac{1}{1 - c^r_{a+}} \\ . \\] After the equilibrium age-structure is calculated, there is an option to estimate global or region specific deviations to allow the model to start with a non-equilibrium age-structure \\[ N_{a, r} = N_{a, r} e^{\\epsilon_a} \\ \\ \\forall \\ a \\ r \\ . \\] To help with estimation there is a penalty on \\(\\epsilon_a\\) that assumes a central tendancy of zero with an estimable variance parameter (\\(\\sigma_{\\epsilon}^2\\)). \\[ \\epsilon_a \\sim \\mathcal{N}(0, \\sigma_{\\epsilon}) \\] In general these parameters can be highly uncertain. The variance on these deviation parameters is often fixed at a low value which requires a strong signal in the data to deviate away from the initial equilibrium age-structure. Growth Empirical length at age matrices are supplied for all years where sufficient age-length data was available and growth was assumed the same across all regions. Mean weight at age was calculated using an allometric length weight relationship with time and space invariant parameters \\(\\alpha\\) and \\(\\beta\\) \\[ \\bar{w}_{a,y} = \\alpha \\bar{l}_{a,y}^{\\beta} \\] TODO add the adjustment for lognormal distribution as in Casal2. Recruitment How to spatially apportion recruits in a way that is consistent with the data and isnt confounded with movement of young fish? There are two considerations, firstly looking at the AF and LFs there are regions that seem to have more young fish than others (link to figure and describe). However, there is very little information on spawning grounds and behavior. This coupled with a complex early life history make it difficult to a priori set regional apportionment of recruits, which would be ideal, an alternative is to estimate these as free parameters. This may introduce confounding when we start estimating movement which is believed to be ontogenetic. Fishing mortality When the hybrid \\(F\\) method is assumed, tagged fish were not included when internally solving the fishing mortality nuisance parameters. The ratio of tagged to untagged numbers of fish in the partition in any year was assumed to be small enough not to effect \\(F\\) estimates. However, tagged fish were included when the model calculates predicted catch-at-age/length and catch for a fleet. This decision was made to reduce the computational overhead this would require to implement. When \\(F\\) parameters are estimated as free parameters, then this is not a problem and \\(F\\) will be applied to both tagged and untagged fish. Tag release events Tags release event denoted by the index \\(k\\) have an implied region \\(r\\) and year \\(y\\) dimension. Each tag release event has known sex and age frequency at release. This is derived using the age-length key from the survey. Tagged fish from release event \\(k\\) are denoted in the partition by \\(N^k_{a,r,y,s}\\), and are tracked for \\(n_{T}\\) years before migrating into a pooled tag group, at which point we loose release-event information because we loose the year information but we do maintain its region of release. At present, tagged fish are assumed to take on the exact same population processes as the untagged elements of the partition. Most of the tagged fish in the available have unknown sex. Sex disaggregated age-frequencies were derived using an ALK that was disaggregrated by sex in the age dimension but sex aggregated in the length dimension. This meant when we multiplied an unsexed length frequency through this ALK we obtained sex disaggregated age frequency. The negative of this approach is a tagged fish that would have an exact age, sex and length will be represented in the model as a fraction of a fish across multiple ages and sexes. Age length keys were not available in all years when tagged fish were released, particularly in the early period. Tag release age frequencies before 1981 were based on age-length keys pooled over years 1981, 1985 and 1987. After that period, if an age-length key was not available we used the age length key from the closest year that has an age-length key. (How can we explore uncertainty in this input? re-run the model with numbers at age and length from bootstrapping age-length keys?) Observation equations As in the current stock assessment model, there are the three conventional observation types in the spatial model Relative indices of abundance Age composition disaggregated by sex for the fixed gear fishery and longline survey Length composition disaggregated by sex for the trawl and early period of the fixed gear fishery In addition to these, tag-recoveries are also included in the model. Catch at age Fishery dependent catch at age observations are available for the fixed gear fishery, but are also needed to calculate catch at length observations for the trawl fishery. Catch at age for fishery \\(g\\) is denoted by \\({C}^g_{a,r,y,s}\\) and model fitted values are calculated following \\[\\begin{equation} {C}^g_{a,r,y,s} = \\frac{F^g_{a,r,y,s}}{Z_{a,r,y,s}} N_{a,r,y,s} \\left(1 - S_{a,r,y,s} \\right) \\end{equation}\\] Observed values were proportions with respect to age and sex, final model fitted proportions were \\[ {P}^g_{a,r,y,s} = \\frac{{C}^g_{a,r,y,s}}{\\sum_a \\sum_s {C}^g_{a,r,y,s}}, \\] and initially the multinomial likelihood was assumed \\[ \\boldsymbol{X}^g_{r,y} \\sim \\text{Multinomial}\\left(\\boldsymbol{\\widehat{P}}^g_{r,y}\\right) \\] where, \\(\\boldsymbol{X}^g_{r,y} = \\boldsymbol{P}^g_{r,y}N^{eff}_{r,y}\\) and \\(\\boldsymbol{P}^g_{r,y}\\) is the observed proportions, \\(N^{eff}_{r,y}\\) is the effective sample size and \\(\\boldsymbol{P}^g_{r,y} = (P^g_{1,r,y,1}, \\dots, P^g_{a_+,r,y,1}, P^g_{1,r,y,2}, \\dots, P^g_{a_+,r,y,2})\\) is the vector of observed proportions across all ages and sexs in year \\(y\\) and region \\(r\\), and \\(\\boldsymbol{\\widehat{P}}^g_{r,y}\\) is the model fitted values which have the same dimension (\\(\\sum_a \\sum_s \\widehat{P}^g_{a,r,y,s} = 1\\)). Catch at length Catch at length observations are available for the trawl fishery. Model fitted values are derived by multiplying the catch at age (see above) by an age-length transition matrix denoted by \\(\\boldsymbol{A}^l_{y,s}\\) (dimensions of \\(\\boldsymbol{A}^l_{y,s}\\) are \\(n_a \\ \\times \\ n_l\\) and its rows must sum to 1), \\[\\begin{equation} \\widehat{\\boldsymbol{Cl}}^g_{r,y,s} = \\left(\\boldsymbol{A}^l_{y,s} \\right)^T \\ \\times \\ \\widehat{\\boldsymbol{C}}^g_{r,y,s} \\end{equation}\\] where, \\(\\widehat{\\boldsymbol{C}}^g_{r,y,s}\\) is a column vector of catch at age (dimension \\(n_a \\ \\times \\ 1\\)) at the beginning of year \\(y\\) in region \\(r\\) for sex \\(s\\), and \\(\\widehat{\\boldsymbol{Cl}}^g_{r,y,s}\\) is a column vector of catch at length (dimension \\(n_l \\ \\times \\ 1\\)). Proportions at age Survey age composition data denoted by \\({N}^s_{a,r,y,s}\\) is available for the longline survey where model fitted numbers are derived as, \\[\\begin{equation} \\widehat{N}^s_{a,r,y,s} = N_{a,r,y,s} \\left(1 - \\exp^{\\delta_y Z_{a,r,y,s}}\\right)S^s_{y,r,a,s} \\end{equation}\\] where, \\(\\delta_y \\in (0,1)\\) is the proportion of time in the year that the observation occurs during year \\(y\\) and \\(S^s_{y,r,a,s}\\) is the survey selectivity. Relative abundance indices \\[\\begin{equation} \\widehat{I}^s_{r,y} = \\sum_s\\sum_a \\widehat{N}^s_{a,r,y,s} \\bar{w}_{a,y,s} \\end{equation}\\] where, \\(\\bar{w}_{a,y,s}\\) is mean weight at age, this can be omitted if the observation is in numbers i.e., abundance instead of biomass. Tag recovery observations When tagged fish are released in to the model partition they are tracked by the tag release event \\(k\\) for \\(n_{T}\\) years. Due to tags being predominately recovered by the fixed gear fishery there are many recoveries for which there is no length or sex information (get a number). The model expects tag-recovery observations to be known by age and sex. These are derived for each recovery event (also year and region specific) and tag-release event by using the age-length key that was used to release each recovered fish to obtain an sex specific age-frequency. This age-frequency is then aged by the number of years this tag-recovery event was at liberty to derive observed tag-recoveries by age and sex. This assumes the age-length conversion between releases and recoveries is consistent and allows us to use recovered fish with no length or sex recorded, but has the down side as mentioned earlier in the tag release section of smearing a single recovered fish across multiple age bins and sexes. However, it does mitigate the problem of going backwards and forwards through the age-length transition matrix, which appears to be more problematic. All tag recoveries are from the fixed gear (longline and pot gear) fishery, due to the recent trend in recoveries by gear method Model fitted values for tag event \\(k\\) recovered in region \\(r\\) and year \\(y\\) are denoted by \\(\\widehat{N}^k_{a,r,y,s}\\), and are derived as \\[ \\widehat{N}^k_{a,r,y,s} = N^k_{a,r,y,s}e^{-0.5M_{y}} (1 - e^{-F^{LL}_{a,r,y,s}})\\delta_y \\] where, \\(N^k_{a,r,y,s}\\) are the number of tagged fish from tag-release event \\(k\\), and \\(\\delta_y\\) is the reporting rate in year \\(y\\). We assume there has been half the years natural mortality when deriving expected tag-recoveries. The current assessment pools observed and fitted values across age and sex and assumes the are from the Poisson distribution. \\[ {N}^k_{r,y} \\sim \\mathcal{Poisson}(\\widehat{N}^k_{r,y}) \\] where, \\(\\widehat{N}^k_{r,y} = \\sum_a \\sum_s \\widehat{N}^k_{a,r,y,s}\\) Symbol Notation Symbol Description \\(y\\) Year, \\(y = 1960, \\dots, T\\) \\(T\\) Terminal year of the model \\(s\\) Sex index \\(s \\in \\{1,2\\}\\) \\(a\\) Model age cohort, i.e., \\(a = a_0, a_0 + 1, \\dots\\) \\(a_{1}\\) Recruitment age to the model = 2 \\(a_+\\) Plus-group age class (oldest age considered plus all older ages) \\(n_a\\) Number of age classes modeled \\(a_+ \\ - a_1\\) \\(l\\) length class \\(n_l\\) Number of length classes \\(g\\) gear type index, i.e. longline survey, fixed gear fishery, trawl fishery \\(x\\) log-likelihoos index \\(\\bar{w}_{a,y, s}\\) Average weight at age \\(a\\), year \\(y\\) and sex \\(s\\) \\(\\phi_{a,y}\\) Proportion of female mature by age and year \\(p^s_{y}\\) Proportion of recruits for sex \\(s\\). Often assumed = 0.5 \\(\\ln \\mu_{r}\\) Average log-recruitment \\(\\ln \\mu_{f}\\) Average log-fishing mortality \\(\\phi_{y,g}\\) annual fishing mortality deviation by gear (log space) \\(\\tau_{y}\\) annual recruitment deviation \\(\\sim LogNormal\\left(0,\\sigma_r\\right)\\) \\(\\sigma_r\\) Recruitment standard deviation \\(N_{a,y,s}\\) Numbers of fish at age \\(a\\) in year \\(y\\) of sex \\(s\\) \\(M\\) Natural mortality \\(F^g_{a,y}\\) Fishing mortality for year \\(y\\), age \\(a\\) and gear \\(g\\) \\(F_{hist}\\) Historical proportion of Fishing mortality \\(Z_{a,y}\\) Total mortality for year \\(y\\), age \\(a\\) \\(=\\sum\\limits_g F^g_{a,y} + M\\) \\(R_{y}\\) Annual recruitment \\(B_{y}\\) Spawning biomass in year \\(y\\) \\(S^g_{a,y,s}\\) Selectivity at age \\(a\\) for gear type \\(g\\) and sex \\(s\\) \\(a_50\\) age at 50% selection for ascending limb \\(d_50\\) age at 50% selection for descending limb \\(\\delta\\) slope/shape parameters for different logistic curves \\(\\boldsymbol{A}\\) ageing-error matrix dimensions \\(n_a \\ \\times \\ n_a\\) \\(\\boldsymbol{A}^l_s\\) age to length conversion matrix by sex. dimensions \\(n_a \\ \\times \\ n_l\\) \\(q_g\\) abundance index catchability coeffecient by gear \\(\\lambda_x\\) Statistical weight (penalty) for component \\(x\\) \\(P^g_{l,y,s}\\) Observed proportions at length for gear \\(g\\) in year \\(y\\) and sex \\(s\\) \\(P^g_{a,y,s}\\) Observed proportions at age for gear \\(g\\) in year \\(y\\) and sex \\(s\\) "],["TagIntegrated.html", "Chapter 5 TagIntegrated data and parameter descriptions 5.1 data 5.2 parameters", " Chapter 5 TagIntegrated data and parameter descriptions Users need to population a data and parameters named list object that is then passed to TMBs MakeADFun. These sections outline the elements and corresponding dimensions of both data and parameters. 5.1 data ages vector of ages. Length n_ages years vector of years from start year to current year. length n_years length_bins vector of length bin midpoints. length. n_length_bins n_projections_years integer of future years to project the model n_projyears = n_years + n_projections_years do_projection integer 0 means dont do projection 1 does a stochastic projection n_regions integer needs to be greater than 1 global_rec_devs integer 1 means all regions share the same recruitment deviations. 0 means they have separate global recruitment deviations. This will effect the dimensions of the parameter ln_rec_dev n_init_rec_devs number of initial n_age_deviations (parameter$ln_init_rec_dev) to multiply against the initial numbers at age to have non equilibrium initial age-structure. A value of zero will not apply these initial devs and expects parameter$ln_init_rec_dev to have length 1. M Natural mortality array with dimensions n_ages \\(\\times\\) n_projyears maturity proportion mature array with dimensions n_ages \\(\\times\\) n_projyears male_mean_weight_by_age male mean weight at age array with dimensions n_ages \\(\\times\\) n_projyears. Units are in kgs, this is because we track 000s of fish in the partition. female_mean_weight_by_age female mean weight at age array with dimensions n_ages \\(\\times\\) n_projyears. Units are in kgs, this is because we track 000s of fish in the partition. male_age_length_transition male age-length transtion matrix for each year. An array with dimensions n_ages \\(\\times\\)n_length_bins \\(\\times\\) n_projyears female_age_length_transition female age-length transtion matrix for each year. An array with dimensions n_ages \\(\\times\\)n_length_bins \\(\\times\\) n_projyears sigma_R Scalar defining the standard deviation for recruitment deviations SrType Stock recruitment type 1 = Beverton holt, 2 = Ricker, 3 = average spawning_time_proportion vector of proportions that indicate when during the year spawning occurs. Length = n_projyears apply_fixed_movement integer whether to apply the input fixed_movement_matrix or estimated movement matrix. This was added because the transformation on estimated movement parameters does not allow values to be zero or one so cannot truly apply no movement. That is when I have used this fixed movement fixed_movement_matrix movement matrix with dimensions n_regions \\(\\times\\)n_regions. Rows sum equal to one. prop_F_hist scalar proportion of longline average F that is applied during initialization. F_method integer, if = 0 then we estimate mean and deviation F free parameters, otherwise if equal 1, use newton raphson iterations and solve F F_max scalar Maxium F when using the F_method = 1 F_iterations integer how many newton raphson iterations are done to solve F when F_method = 1 fixed_fishery_catch vector of annual catch for the fixed gear fishery. Units are kilo tonnes trwl_fishery_catch vector of annual catch for the Trawl gear fishery. Units are kilo tonnes fixed_sel_type vector of integers specifying the selectivity type in each time-block length(unique(fixed_sel_by_year_indicator)). Values 0 = logistic, 1 = Double normal, 2 = power function, 3 = alternative logistic formulation fixed_sel_by_year_indicator vector of integers specifying which selectivity time-block to apply in each year (C++ indexing so start at zero) trwl_sel_type vector of integers specifying the selectivity type in each time-block length(unique(trwl_sel_by_year_indicator)). Values 0 = logistic, 1 = Double normal, 2 = power function, 3 = alternative logistic formulation trwl_sel_by_year_indicator vector of integers specifying which selectivity time-block to apply in each year (C++ indexing so start at zero) srv_dom_ll_sel_type vector of integers specifying the selectivity type in each time-block, length(unique(srv_dom_ll_sel_by_year_indicator)). Values 0 = logistic, 1 = Double normal, 2 = power function, 3 = alternative logistic formulation srv_dom_ll_sel_by_year_indicator vector of integers specifying which selectivity time-block to apply in each year (C++ indexing so start at zero) tag_release_event_this_year vector of integers specifying whether tags are released in each year. Length n_years. n_years_with_tag_releases = sum(tag_release_event_this_year) male_tagged_cohorts_by_age Numbers of male tagged fish. Dimension n_ages \\(\\times\\) n_region \\(\\times\\) n_years_with_tag_releases. These are in actual numbers not 1000s of fish, like the recruitment parameters female_tagged_cohorts_by_age Numbers of female tagged fish. Dimension n_ages \\(\\times\\) n_region \\(\\times\\) n_years_with_tag_releases. These are in actual numbers not 1000s of fish, like the recruitment parameters n_years_to_retain_tagged_cohorts_for integer, number of years to keep release event information on tag-releases initial_tag_induced_mortality vector or initial tag release mortality with length n_years_with_tag_releases annual_tag_shedding_rate scalar for annual tag-shedding rate ageing_error_matrix ageing error matrix n_ages \\(\\times\\) n_ages fixed_catchatage_indicator an indicator array for fixed gear catch at age observation with dimensions n_regions \\(\\times\\) n_years. A one indicates there is a catch at age observation for the fixed fishery in this region and year. A zero indicates no observation. obs_fixed_catchatage fixed catch at age observation with dimensions n_ages * 2 \\(\\times\\) n_regions \\(\\times\\) n_years. The first dimension represents sex and age with males being the first age block followed by females. This observation is in numbers which is equivalent to proportions times the effective sample size. Predicted proportions will sum = 1 over the age and sex dimension. fixed_catchatage_covar_structure integer, this is a place holder doesnt do anything yet, will be used when there is alternative composition likelihoods. fixed_catchatage_comp_likelihood integer, this is a place holder doesnt do anything yet, will be used when alternative composition likelihoods are available. trwl_catchatlgth_indicator an indicator array for trawl gear catch at length observation with dimensions n_regions \\(\\times\\) n_years. A one indicates there is a catch at length observation for the trawl fishery in this region and year. A zero indicates no observation. obs_trawl_catchatlgth fixed catch at length observation with dimensions n_length_bins * 2 \\(\\times\\) n_regions \\(\\times\\) n_years. The first dimension represents length bin and age with males being the first length block followed by females. This observation is in numbers which is equivalent to proportions times the effective sample size. Predicted proportions will sum = 1 over the length and sex dimension. trwl_catchatlgth_covar_structure integer, this is a place holder doesnt do anything yet, will be used when there is alternative composition likelihoods. trwl_catchatlgth_comp_likelihood integer, this is a place holder doesnt do anything yet, will be used when alternative composition likelihoods are available. fixed_catchatlgth_indicator an indicator array for fixed gear catch at length observation with dimensions n_regions \\(\\times\\) n_years. A one indicates there is a catch at length observation for the fixed gear fishery in this region and year. A zero indicates no observation. obs_fixed_catchatlgth fixed catch at length observation with dimensions n_length_bins * 2 \\(\\times\\) n_regions \\(\\times\\) n_years. The first dimension represents length bin and age with males being the first length block followed by females. This observation is in numbers which is equivalent to proportions times the effective sample size. Predicted proportions will sum = 1 over the length and sex dimension. fixed_catchatlgth_covar_structure integer, this is a place holder doesnt do anything yet, will be used when there is alternative composition likelihoods. fixed_catchatlgth_comp_likelihood integer, this is a place holder doesnt do anything yet, will be used when alternative composition likelihoods are available. srv_dom_ll_catchatage_indicator an indicator array for survey longline catch at age observation with dimensions n_regions \\(\\times\\) n_years. A one indicates there is a catch at age observation for the longline survey in this region and year. A zero indicates no observation. obs_srv_dom_ll_catchatage fixed catch at length observation with dimensions n_ages * 2 \\(\\times\\) n_regions \\(\\times\\) n_years. The first dimension represents age and age with males being the first age block followed by females. This observation is in numbers which is equivalent to proportions times the effective sample size. Predicted proportions will sum = 1 over the age and sex dimension. srv_dom_ll_catchatage_covar_structure integer, this is a place holder doesnt do anything yet, will be used when there is alternative composition likelihoods. srv_dom_ll_catchatage_comp_likelihood integer, this is a place holder doesnt do anything yet, will be used when alternative composition likelihoods are available. srv_dom_ll_bio_indicator an indicator array for survey longline abundance observation with dimensions n_regions \\(\\times\\) n_years. A one indicates there is an abundance observation for the longline survey in this region and year. A zero indicates no observation. obs_srv_dom_ll_bio domestic survey abundance observation n_regions \\(\\times\\) n_years. This observation is in numbers (000s) which is equivalent to proportions times the effective sample size. Predicted proportions will sum = 1 over the age and sex dimension. obs_srv_dom_ll_se Standard error for the domestic survey abundance observation srv_dom_ll_bio_comp_likelihood integer, this is a place holder doesnt do anything yet, will be used when alternative composition likelihoods are available. srv_dom_ll_q_by_year_indicator indicator vector, this indicates how many time-blocks for time-varying catchabilities are available. Each element links an element of the parameter logistic_srv_dom_ll_q for a year. tag_recovery_indicator an indicator vector for tag-recovery observations has length n_years. A one indicates there is a tag recovery observation in this year. A zero indicates no observation. This object is used to define n_tag_recovery_years = sum(tag_recovery_indicator), which links to other tag-recovery structures tag_recovery_indicator_by_release_event_and_recovery_region an indicator vector for tag-recovery observations with dimensions n_tag_release_events \\(\\times\\) n_regions \\(\\times\\) n_tag_recovery_years. A one indicates there is a tag recovery observation, a zero indicates no observation. obs_tag_recovery tag-recovery observation with dimensions n_ages * 2 \\(\\times\\) n_tag_release_events \\(\\times\\) n_regions \\(\\times\\) n_tag_recovery_years. Although age and sex is included in this observation, the current likelihood pools observations and expected values of age and sex. Units are numbers (can be non-integer) of recoveries. tag_likelihood integer specifying the tag-likelihood, 0 = Poisson, 1 = negative binomial. 5.2 parameters ln_mean_rec vector of natural logarithm of mean recruitment (units are 000s) for each region. length n_regions. ln_rec_dev array of recruitment deviations. if global_rec_devs = 1 then this has dimension 1 \\(\\times\\) n_years, else it has a row for each region and dimension n_regions\\(\\times\\) n_years ln_init_rec_dev vector of initial devs to multiple to initial numbers at age for non-equilibrium age-structure. Must have length equal to data$n_init_rec_devs. The first dev, corresponds to the second age we the last value gets applied to all successive ages i.e., if length(ln_init_rec_dev) = 10, the first value numbers_at_age[2] * exp(ln_init_rec_dev[1]), and numbers_at_age[11:n_ages] * exp(ln_init_rec_dev[10]) ln_fixed_sel_pars array of log selectivity parameters for fixed gear fishery with dimension n_time_blocks\\(\\times\\) max(sel parameters)\\(\\times\\) 2 (for each sex) male parameters first followed by female. The number of time-blocks is defined by the data parameter data$fixed_sel_by_year_indicator and max selectivity parameters controlled by data$fixed_sel_type which defines the selectivity shape and thus number of parameters. ln_trwl_sel_pars array of log selectivity parameters for trawl gear fishery with dimension n_time_blocks\\(\\times\\) max(sel parameters)\\(\\times\\) 2 (for each sex) male parameters first followed by female. The number of time-blocks is defined by the data parameter data$trwl_sel_by_year_indicator and max selectivity parameters controlled by data$trwl_sel_type which defines the selectivity shape and thus number of parameters. transformed_movement_pars array of movement parameters that are transformed in the simplex space. It has dimension n_regions - 1 \\(\\times\\) n_regions. Use the packages inbuilt simplex() and restoresimplex() functions to change a vector that sums to one to a simplex with n-1 parameters. ln_fixed_F_avg scalar for the log average fishing mortality of the fixed gear fishery. Should be not estimated if data$F_method = 1 ln_fixed_F_devs annual fishing mortality deviations from ln_fixed_F_avg. Expected dimensions are n_regions \\(\\times\\) n_years. Should be not estimated if data$F_method = 1 ln_trwl_F_avg scalar for the log average fishing mortality of the fixed gear fishery. Should be not estimated if data$F_method = 1 ln_trwl_F_devs annual fishing mortality deviations from ln_trwl_F_avg. Expected dimensions are n_regions \\(\\times\\) n_years. Should be not estimated if data$F_method = 1 ln_init_F_avg scalar for the log fishing mortality applied during initialisation. ln_catch_sd scalar for the log catch standard deviation logistic_srv_dom_ll_q vector of logistic catchabilities. Should have length of q time-blocks which is defined by data$srv_dom_ll_q_by_year_indicator ln_srv_dom_ll_sel_pars array of log selectivity parameters for domestic longline fishery with dimension n_time_blocks\\(\\times\\) max(sel parameters)\\(\\times\\) 2 (for each sex) male parameters first followed by female. The number of time-blocks is defined by the data parameter data$srv_dom_ll_sel_by_year_indicator and max selectivity parameters controlled by data$srv_dom_ll_sel_type which defines the selectivity shape and thus number of parameters. logistic_tag_reporting_rate logistic tag-reporting rates. Expected dimensions are n_regions \\(\\times\\) n_tag_recovery_years. ln_tag_phi scalar which is the log of the dispersion parameter. Only used if data$tag_likelihood == 1 i.e. the negative binomial distribution is assumed. "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
